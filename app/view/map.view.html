<section layout-gt-xs="row" layout-xs="column" layout-fill flex class="map">
    <div class="sidebar" layout-gt-xs="column" layout-xs="row" layout-align="center center">
        <md-button class="md-icon-button" aria-label="Menu" ng-click="submenu.toggle()">
            <md-icon aria-label="Menu" class="material-icons md-24" md-colors="::{color:'grey-50'}">menu</md-icon>
        </md-button>
        <div layout-gt-xs="column" layout-xs="row" flex layout-align-gt-xs="center center" layout-align-xs="end center">
            <md-button class="md-icon-button" aria-label="World" ng-class="{active:submenu.active===0}"
                       ng-click="submenu.active=0;">
                <md-icon aria-label="World" class="material-icons md-24">public</md-icon>
            </md-button>

            <md-button class="md-icon-button" aria-label="Group" ng-class="{active:submenu.active===1}"
                       ng-click="submenu.active=1">
                <md-icon aria-label="Group" class="material-icons md-24">people</md-icon>
            </md-button>

            <md-button class="md-icon-button" ng-class="{active:submenu.active===2}" ng-click="submenu.active=2">
                <md-icon aria-label="Friend" class="material-icons md-24">person_pin</md-icon>
            </md-button>
        </div>
    </div>
    <md-sidenav class="md-sidenav-left" md-component-id="left" md-is-locked-open="$mdMedia('gt-sm')" md-whiteframe="4">
        <md-tabs class="tabs" md-selected="submenu.active" flex md-no-ink md-no-ink-bar>
            <md-tab>
                <md-tab-body>
                    <div layout="column" layout-fill>
                        <md-toolbar class="md-tall">
                            <div flex></div>
                            <div class="md-toolbar-tools">
                                <h2 flex md-truncate>{{inSmallScreen?me.first_name:me.name}}'s friends</h2>
                                <md-button class="md-icon-button" ng-click="openId($root.me.id)" ng-disabled="!$root.progress.all"
                                           aria-label="Find me">
                                    <md-icon aria-label="Friend" class="material-icons md-24">face</md-icon>
                                    <md-tooltip md-delay="400" md-direction="right">Find me</md-tooltip>
                                </md-button>
                            </div>
                        </md-toolbar>
                        <md-content flex>
                            <md-list class="list">
                                <md-subheader class="md-no-sticky">
                                    <div layout="row">
                                        <span flex>Online friends </span><b ng-if="$root.progress.all">({{$root.friends.length}})</b>
                                    </div>
                                </md-subheader>
                                <md-list-item layout="row" ng-if="!$root.progress.all">
                                    <div flex layout="row" layout-align="center center">
                                        <md-progress-circular class="md-hue-2" md-diameter="20"></md-progress-circular>
                                    </div>
                                </md-list-item>
                                <md-list-item ng-repeat="i in $root.friends|orderBy:'-date'" ng-click="openId(i.id)">
                                    <img alt="{{i.first_name}}" ng-src="{{i.picture.data.url}}" class="md-avatar"/>
                                    <p md-truncate>{{inSmallScreen?i.first_name:i.name}}</p>
                                    <md-button class="md-icon-button status-light" md-no-ink aria-label="Status">
                                        <md-icon aria-label="" class="material-icons md-24" ng-class="i.date|old:'old-'">
                                            {{i.device===1?'desktop_windows':i.device===2?'smartphone':'brightness_1'}}
                                        </md-icon>
                                        <md-tooltip md-delay="400" md-direction="right">{{i.date|ago}}</md-tooltip>
                                    </md-button>
                                </md-list-item>
                                <md-subheader class="md-no-sticky">
                                    <div layout="row">
                                        <span flex>Offline friends </span><b ng-if="$root.progress.all">({{0}})</b>
                                    </div>
                                </md-subheader>
                                <md-list-item layout="row" ng-if="!$root.progress.all">
                                    <div flex layout="row" layout-align="center center">
                                        <md-progress-circular class="md-hue-2" md-diameter="20"></md-progress-circular>
                                    </div>
                                </md-list-item>
                            </md-list>
                        </md-content>
                    </div>
                </md-tab-body>
            </md-tab>
            <md-tab>
                <md-tab-body>
                    <div layout="column" layout-fill>
                        <md-toolbar class="md-tall">
                            <div flex></div>
                            <div class="md-toolbar-tools">
                                <h2 flex md-truncate>{{inSmallScreen?me.first_name:me.name}}'s groups</h2>
                                <md-button class="md-fab btn-middle" aria-label="Create group"
                                           ng-class="{active:group.adding}" ng-click="group.adding=true"></md-icon>
                                    <md-icon aria-label="Add" class="material-icons">add</md-icon>
                                </md-button>
                            </div>
                        </md-toolbar>
                        <md-content flex>
                            <md-list class="list">
                                <md-subheader class="md-no-sticky">
                                    <div layout="row">
                                        <span flex>Online groups </span>
                                    </div>
                                </md-subheader>
                                <md-list-item class="md-2-line" ng-repeat="i in group.list|orderBy:'-date'" ng-click="group.select(i)">
                                    <md-icon class="material-icons md-avatar-icon"
                                             md-colors="::{backgroundColor: '{{i.theme}}'}">people</md-icon>
                                    <div class="md-list-item-text">
                                        <h3 md-truncate>{{i.name}}</h3>
                                        <p md-truncate>
                                            <img ng-repeat="j in i.members|limitTo:5" ng-src="{{j.photo.origin}}" class="md-avatar avatar-small">
                                            <span>{{i.description}}</span>
                                        </p>
                                    </div>
                                    <div class="md-secondary md-icon-button" aria-label="new">
                                        <md-icon class="material-icons">new_releases</md-icon>
                                    </div>
                                </md-list-item>
                            </md-list>
                        </md-content>
                    </div>
                </md-tab-body>
            </md-tab>
            <md-tab>
                <md-tab-body>
                    <div layout="column" layout-fill>
                        <md-toolbar class="md-tall">
                            <div flex></div>
                            <div class="md-toolbar-tools">

                            </div>
                        </md-toolbar>
                        <md-content flex>
                            <md-list class="list">
                                <md-subheader class="md-no-sticky">
                                    <div layout="row">
                                        <span flex>Recent</span>
                                    </div>
                                </md-subheader>
                                <md-list-item class="md-2-line" ng-repeat="i in notification.list|orderBy:'-date'" ng-click="notification.select(i)">
                                    <md-icon class="material-icons md-avatar-icon">chat bubble</md-icon>
                                    <div class="md-list-item-text">
                                        <h3 md-truncate translate translate-values="i.mention">{{'notification.'+i.channel+i.template}}</h3>
                                        <p md-truncate>
                                            <span>{{i.date|date:'short'}}</span>
                                        </p>
                                    </div>
                                    <div class="md-secondary md-icon-button" aria-label="new">
                                        <md-icon class="material-icons">new_releases</md-icon>
                                    </div>
                                </md-list-item>
                            </md-list>
                        </md-content>
                    </div>
                </md-tab-body>
            </md-tab>
        </md-tabs>
    </md-sidenav>
    <md-content flex layout="column" class="map-area">
        <!--<div class="map-mask" layout="column" layout-align="center center" ng-if="!$root.progress.all">-->
            <!--<md-progress-circular md-mode="determinate" value="{{$root.progress.current}}"></md-progress-circular>-->
            <!--<div layout-padding>{{$root.progress.message}}</div>-->
        <!--</div>-->
        <map-term flex ng-if="!term.allowed" on-agree="term.agree(value)" on-disagree="term.disagree(value)"></map-term>
        <ui-gmap-google-map ng-if="term.allowed" flex center="map.center" zoom="map.zoom" bounds="map.bounds" pan="true" events="map.events">
            <ui-gmap-markers models="marker.list" coords="'coords'" options="'options'" click="marker.click"
                             doCluster="true" clusterOptions="marker.cluster">
            </ui-gmap-markers>
        </ui-gmap-google-map>
        <div class="cards-swipe cards-swipe-bottom transit-up-down" ng-if="carousel.active!==-1"
             ng-class="{detail:carousel.detail}" ng-init="carousel.detail=null;carousel.lock=false">
            <ul class="cards-wrap" rn-carousel rn-carousel-index="carousel.active"
                rn-carousel-easing="easeOutCubic" rn-carousel-locked="carousel.lock">
                <li ng-repeat="m in marker.list">
                    <md-card class="card" ng-class="{active:carousel.active===$index}">
                        <div class="card-head">
                            <div class="card-head-cover" md-colors="::{backgroundColor:'primary'}">
                                <div layout="row" layout-align="space-around start">
                                    <div layout="row" flex>
                                        <md-button class="md-icon-button" aria-label="Close"
                                                   ng-click="marker.close()">
                                            <md-icon class="material-icons">close</md-icon>
                                        </md-button>
                                    </div>
                                    <div layout="row">
                                        <md-button class="md-icon-button" aria-label="More"
                                                   ng-click="carousel.detail?marker.less():marker.more(m)">
                                            <md-icon class="material-icons">{{carousel.detail?'keyboard_arrow_down':'keyboard_arrow_up'}}</md-icon>
                                        </md-button>
                                    </div>
                                </div>
                            </div>
                            <div class="user-photo">
                                <div class="user-round-photo">
                                    <img ng-src="{{m.fb.picture.data.url}}" alt="::{{m.fb.name}}"/>
                                </div>
                            </div>
                        </div>
                        <md-card-content class="card-item">
                            <div class="card-txt">
                                <div class="md-title" md-truncate>{{m.fb.name}}</div>
                                <div class="md-caption">
                                    <span ng-if="!m.me">{{m.distance/1000|number}}km</span>
                                    <span ng-if="!m.me">{{m.date|ago}}</span>
                                    <span ng-if="m.me">You're here!</span>
                                </div>
                            </div>
                            <md-card-actions layout="row" layout-align="center start">
                                <md-button class="md-icon-button" ng-click="carousel.actions.hi(m)" ng-if="!m.me" ng-disabled="m.status.waving" aria-label="Say hello">
                                    <md-icon class="material-icons md-green">pan_tool</md-icon>
                                </md-button>
                                <md-button class="md-icon-button" ng-click="carousel.actions.focus(m)" aria-label="Focus">
                                    <md-icon class="material-icons md-green">gps_fixed</md-icon>
                                </md-button>
                                <md-button class="md-icon-button" ng-click="$root.direct.toMe()" ng-if="!m.me"
                                           aria-label="Go to">
                                    <md-icon class="material-icons md-green">directions</md-icon>
                                </md-button>
                            </md-card-actions>
                        </md-card-content>
                    </md-card>
                </li>
            </ul>
        </div>
        <div class="cards-swipe cards-swipe-top transit-down-up" ng-if="submenu.active===1"
             ng-class="{detail:group.carousel.detail}" ng-init="group.carousel.detail=null;">
            <ul class="cards-wrap" rn-carousel rn-carousel-index="group.carousel.active"
                rn-carousel-easing="easeOutCubic" rn-carousel-locked="carousel.lock">
                <li ng-repeat="m in group.list">
                    <md-content md-theme="lime-dark" class="card" ng-class="{active:group.carousel.active===$index}">
                        <md-list class="group-head">
                            <md-list-item class="group-head-line md-2-line">
                                <md-icon class="material-icons md-avatar-icon">people</md-icon>
                                <div class="md-list-item-text">
                                    <h3>{{m.name}}</h3>
                                    <p>{{m.description}}</p>
                                </div>
                                <md-button class="md-secondary md-icon-button" aria-label="edit"
                                           ng-click="group.carousel.detail?group.carousel.less():group.carousel.more(m)">
                                    <md-icon class="material-icons">{{group.carousel.detail?'close':'more_vert'}}
                                    </md-icon>
                                </md-button>
                            </md-list-item>
                            <md-list-item class="group-tray-list">
                                <div class="layout-row" flex>
                                    <img ng-repeat="j in m.members|limitTo:5" ng-src="{{j.photo.origin}}"
                                         class="md-avatar avatar-small"/>
                                    <div flex class="group-tray-road" md-colors="{background:'accent-400'}"
                                         md-colors-watch="true"></div>
                                    <img ng-repeat="j in m.members|limitTo:0" ng-src="{{j.photo.origin}}"
                                         class="md-avatar avatar-small"/>
                                    <md-button class="md-fab md-accent md-fab-small" aria-label="target">
                                        <md-icon class="material-icons">flag</md-icon>
                                    </md-button>
                                </div>
                            </md-list-item>
                        </md-list>
                        <md-card-content class="card-item card-item-collapse" layout="column" ng-if="group.carousel.detail" flex>
                            <div layout="column">
                                <div class="card-txt">
                                    <div class="md-title" md-truncate>{{m.name}}</div>
                                    <div class="md-caption"></div>
                                </div>
                                <md-card-actions layout="row" layout-align="center start">
                                </md-card-actions>
                            </div>
                        </md-card-content>
                    </md-content>
                </li>
            </ul>
        </div>
        <div class="form transit-left-right" ng-if="group.adding" layout="column" md-whiteframe="4">
            <md-toolbar class="md-tall">
                <div flex></div>
                <div class="md-toolbar-tools">
                    <h2 flex md-truncate>New group</h2>
                    <md-button class="md-icon-button" ng-click="group.adding=false" aria-label="Close">
                        <md-icon class="material-icons md-24">close</md-icon>
                    </md-button>
                </div>
            </md-toolbar>
            <md-content flex>
                <md-subheader class="md-no-sticky">
                    <div layout="row">
                        <span flex>Please fill your group info</span>
                    </div>
                </md-subheader>
                <form name="fields" layout-padding ng-submit="group.create()">
                    <div layout="row" layout-align="start start" layout-wrap>
                        <md-button ng-repeat="theme in group.themes" class="md-fab md-mini"
                                   md-colors="{background:'{{theme}}'}" md-colors-watch="false"
                                   ng-click="group.form.theme=theme">
                            <md-icon aria-label="{{theme}}" class="material-icons md-24"
                                     ng-if="!group.form.theme&&$index===0||group.form.theme===theme"
                                     md-colors="::{color:'grey-50'}">check</md-icon>
                        </md-button>
                    </div>
                    <md-chips class="md-contact-chips" ng-model="group.form.member" md-autocomplete-snap md-require-match="true">
                        <md-chip>
                            <div class="md-contact-avatar"><img ng-src="{{$root.me.picture.data.url}}"></div>
                            <div class="md-contact-name">{{$root.me.first_name}}</div>
                        </md-chip>
                        <md-autocomplete
                                md-menu-class="md-contact-chips-suggestions"
                                md-items="item in $root.friends"
                                md-search-text="group.form.query"
                                md-item-text="item.name"
                                md-no-cache="true"
                                md-autoselect
                                placeholder="Type a friend name">
                            <div class="md-contact-suggestion">
                                <img ng-src="{{item.picture.data.url}}" alt="{{item.first_name}}"/>
                                <span class="md-contact-name" md-highlight-text="group.form.query" md-highlight-flags="i">{{item.name}}</span>
                            </div>
                        </md-autocomplete>
                        <md-chip-template>
                            <div class="md-contact-avatar"><img ng-src="{{$chip.picture.data.url}}"></div>
                            <div class="md-contact-name">{{$chip.first_name}}</div>
                        </md-chip-template>
                    </md-chips>
                    <md-input-container class="md-block">
                        <label>Name</label>
                        <input ng-model="group.form.name">
                    </md-input-container>
                    <md-input-container class="md-block">
                        <label>Description</label>
                        <textarea ng-model="group.form.description" md-maxlength="150" rows="1" md-select-on-focus></textarea>
                    </md-input-container>
                    <div layout="row" layout-align="center center">
                        <md-button class="md-raised" ng-click="group.adding=false">Cancel</md-button>
                        <md-button class="md-raised md-primary" type="submit">Create</md-button>
                    </div>
                </form>
            </md-content>
        </div>
    </md-content>
</section>